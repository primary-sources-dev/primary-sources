<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entity Matcher — Primary Sources</title>
    <meta name="description"
        content="Automated entity recognition that maps OCR text to known persons, places, and organizations in the research vault." />

    <!-- CRITICAL CSS: Prevent white flash and basic layout -->
    <style>
        :root {
            --primary: #B08B49;
            --archive-bg: #2E282A;
            --archive-secondary: #D4CFC7;
        }

        html,
        body {
            background-color: var(--archive-bg) !important;
            color: var(--archive-secondary);
            margin: 0;
            padding: 0;
        }

        /* Hide components until JS loads */
        [data-component]:not(.component-loaded) {
            opacity: 0;
            visibility: hidden;
        }
    </style>
    <link rel="stylesheet" href="../../assets/css/tailwind-prod.css">
    <link rel="stylesheet" href="../../assets/css/main.css">
    
    <script src="../../assets/js/components.js" defer></script>
    <script src="../../assets/js/collapsible-menu.js" defer></script>
    <script src="../../assets/js/nav.js" defer></script>
</head>

<body class="bg-archive-bg text-archive-secondary font-mono transition-colors duration-300">

    <!-- MODULAR HEADER -->
    <header data-component="header"
        class="sticky top-0 z-50 w-full border-b border-archive-secondary/20 bg-archive-bg/95 backdrop-blur"></header>
    <div data-component="mega-menu" class="component-loaded"></div>

    <!-- HERO -->
    <section class="relative w-full overflow-hidden bg-archive-dark py-12">
        <div
            class="absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-transparent pointer-events-none">
        </div>
        <div
            class="absolute bottom-0 left-0 right-0 h-16 bg-gradient-to-t from-archive-bg to-transparent pointer-events-none">
        </div>

        <div class="relative z-10 px-6 flex flex-col items-center text-center">
            <span class="text-[10px] font-bold uppercase text-emerald-400 tracking-widest mb-4 flex items-center gap-2">
                <span class="material-symbols-outlined text-sm">link</span>
                Analytical Tool · Live
            </span>
            <h1 class="mb-4 text-4xl font-bold leading-tight text-archive-heading sm:text-5xl uppercase font-display">
                Entity Matcher
            </h1>
            <p class="mb-6 max-w-lg text-sm text-archive-secondary/80">
                Automated entity recognition that maps OCR-extracted text to known persons, places, and organizations
                in the research vault using fuzzy matching and confidence scoring.
            </p>
            <div class="flex flex-wrap justify-center gap-2">
                <span
                    class="text-[9px] font-bold uppercase tracking-widest bg-emerald-500/20 text-emerald-400 px-3 py-1.5 border border-emerald-500/30">
                    Fuzzy Matching
                </span>
                <span
                    class="text-[9px] font-bold uppercase tracking-widest bg-emerald-500/20 text-emerald-400 px-3 py-1.5 border border-emerald-500/30">
                    Entity Linker
                </span>
                <span
                    class="text-[9px] font-bold uppercase tracking-widest bg-emerald-500/20 text-emerald-400 px-3 py-1.5 border border-emerald-500/30">
                    Sidecar Output
                </span>
            </div>
        </div>
    </section>

    <hr class="border-archive-secondary/20" />

    <!-- MAIN CONTENT -->
    <main class="max-w-4xl mx-auto px-6 py-10">

        <!-- WHAT IT DOES -->
        <section class="mb-12">
            <h2
                class="text-xl font-bold text-archive-heading uppercase tracking-wider border-l-4 border-primary pl-4 mb-6">
                What It Does
            </h2>
            <div class="prose prose-invert max-w-none text-archive-secondary/90 text-sm leading-relaxed space-y-4">
                <p>
                    The Entity Matcher bridges the gap between raw OCR text and structured database records. When
                    processing
                    archival documents, it automatically identifies mentions of people, places, and organizations — then
                    links
                    them to existing entities in the research vault.
                </p>
                <p>
                    Using fuzzy string matching, the tool handles common OCR errors and name variations. "R.L. Yates"
                    correctly
                    resolves to "Ralph Leon Yates," and "Dalls, Tex." maps to "Dallas, Texas." Each match includes a
                    confidence
                    score for human review.
                </p>
            </div>
        </section>

        <!-- HOW IT WORKS -->
        <section class="mb-12">
            <h2
                class="text-xl font-bold text-archive-heading uppercase tracking-wider border-l-4 border-primary pl-4 mb-6">
                How It Works
            </h2>
            <div class="bg-archive-dark/30 border border-archive-secondary/20 p-6">
                <div class="flex flex-col md:flex-row items-center justify-center gap-4 text-center">
                    <div class="flex flex-col items-center gap-2">
                        <div
                            class="w-16 h-16 flex items-center justify-center bg-archive-secondary/10 border border-archive-secondary/20">
                            <span class="material-symbols-outlined text-2xl text-archive-secondary">description</span>
                        </div>
                        <span class="text-[10px] uppercase tracking-wider text-archive-secondary/70">OCR Text</span>
                    </div>
                    <span
                        class="material-symbols-outlined text-archive-secondary/30 rotate-90 md:rotate-0">arrow_forward</span>
                    <div class="flex flex-col items-center gap-2">
                        <div
                            class="w-16 h-16 flex items-center justify-center bg-archive-secondary/10 border border-archive-secondary/20">
                            <span class="material-symbols-outlined text-2xl text-archive-secondary">search</span>
                        </div>
                        <span class="text-[10px] uppercase tracking-wider text-archive-secondary/70">NER
                            Extraction</span>
                    </div>
                    <span
                        class="material-symbols-outlined text-archive-secondary/30 rotate-90 md:rotate-0">arrow_forward</span>
                    <div class="flex flex-col items-center gap-2">
                        <div class="w-16 h-16 flex items-center justify-center bg-primary/20 border border-primary/40">
                            <span class="material-symbols-outlined text-2xl text-primary">link</span>
                        </div>
                        <span class="text-[10px] uppercase tracking-wider text-primary">Fuzzy Match</span>
                    </div>
                    <span
                        class="material-symbols-outlined text-archive-secondary/30 rotate-90 md:rotate-0">arrow_forward</span>
                    <div class="flex flex-col items-center gap-2">
                        <div
                            class="w-16 h-16 flex items-center justify-center bg-emerald-500/20 border border-emerald-500/40">
                            <span class="material-symbols-outlined text-2xl text-emerald-400">database</span>
                        </div>
                        <span class="text-[10px] uppercase tracking-wider text-emerald-400">Vault IDs</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- ENTITY TYPES -->
        <section class="mb-12">
            <h2
                class="text-xl font-bold text-archive-heading uppercase tracking-wider border-l-4 border-primary pl-4 mb-6">
                Entity Types
            </h2>
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3">
                <div class="border border-archive-secondary/20 bg-archive-dark/30 p-3 text-center">
                    <span class="text-xs font-bold text-archive-heading uppercase">Person</span>
                    <p class="text-[9px] text-archive-secondary/60 mt-1">Individuals</p>
                </div>
                <div class="border border-archive-secondary/20 bg-archive-dark/30 p-3 text-center">
                    <span class="text-xs font-bold text-archive-heading uppercase">Place</span>
                    <p class="text-[9px] text-archive-secondary/60 mt-1">Locations</p>
                </div>
                <div class="border border-archive-secondary/20 bg-archive-dark/30 p-3 text-center">
                    <span class="text-xs font-bold text-archive-heading uppercase">Org</span>
                    <p class="text-[9px] text-archive-secondary/60 mt-1">Organizations</p>
                </div>
                <div class="border border-archive-secondary/20 bg-archive-dark/30 p-3 text-center">
                    <span class="text-xs font-bold text-archive-heading uppercase">Event</span>
                    <p class="text-[9px] text-archive-secondary/60 mt-1">Historical Events</p>
                </div>
                <div class="border border-archive-secondary/20 bg-archive-dark/30 p-3 text-center">
                    <span class="text-xs font-bold text-archive-heading uppercase">Object</span>
                    <p class="text-[9px] text-archive-secondary/60 mt-1">Physical Items</p>
                </div>
                <div class="border border-archive-secondary/20 bg-archive-dark/30 p-3 text-center">
                    <span class="text-xs font-bold text-archive-heading uppercase">Alias</span>
                    <p class="text-[9px] text-archive-secondary/60 mt-1">Alternate Names</p>
                </div>
                <div class="border border-archive-secondary/20 bg-archive-dark/30 p-3 text-center">
                    <span class="text-xs font-bold text-archive-heading uppercase">Date</span>
                    <p class="text-[9px] text-archive-secondary/60 mt-1">Temporal References</p>
                </div>
                <div class="border border-archive-secondary/20 bg-archive-dark/30 p-3 text-center">
                    <span class="text-xs font-bold text-archive-heading uppercase">Source</span>
                    <p class="text-[9px] text-archive-secondary/60 mt-1">Document References</p>
                </div>
            </div>
        </section>

        <!-- KEY FEATURES -->
        <section class="mb-12">
            <h2
                class="text-xl font-bold text-archive-heading uppercase tracking-wider border-l-4 border-primary pl-4 mb-6">
                Key Features
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="flex gap-4 border border-archive-secondary/20 bg-archive-dark/30 p-4">
                    <div
                        class="flex-shrink-0 w-10 h-10 flex items-center justify-center bg-primary/10 text-primary border border-primary/20">
                        <span class="material-symbols-outlined text-lg">spellcheck</span>
                    </div>
                    <div>
                        <h3 class="font-bold text-archive-heading text-sm uppercase mb-1">Fuzzy Matching</h3>
                        <p class="text-xs text-archive-secondary/70">Handles OCR errors and name variations using
                            Levenshtein distance and phonetic matching algorithms.</p>
                    </div>
                </div>
                <div class="flex gap-4 border border-archive-secondary/20 bg-archive-dark/30 p-4">
                    <div
                        class="flex-shrink-0 w-10 h-10 flex items-center justify-center bg-primary/10 text-primary border border-primary/20">
                        <span class="material-symbols-outlined text-lg">speed</span>
                    </div>
                    <div>
                        <h3 class="font-bold text-archive-heading text-sm uppercase mb-1">Confidence Scoring</h3>
                        <p class="text-xs text-archive-secondary/70">High/Medium/Low confidence ratings for each match,
                            enabling efficient human review of uncertain links.</p>
                    </div>
                </div>
                <div class="flex gap-4 border border-archive-secondary/20 bg-archive-dark/30 p-4">
                    <div
                        class="flex-shrink-0 w-10 h-10 flex items-center justify-center bg-primary/10 text-primary border border-primary/20">
                        <span class="material-symbols-outlined text-lg">output</span>
                    </div>
                    <div>
                        <h3 class="font-bold text-archive-heading text-sm uppercase mb-1">Sidecar Output</h3>
                        <p class="text-xs text-archive-secondary/70">Generates `.entities.json` files alongside OCR
                            output, mapping text spans to database UUIDs.</p>
                    </div>
                </div>
                <div class="flex gap-4 border border-archive-secondary/20 bg-archive-dark/30 p-4">
                    <div
                        class="flex-shrink-0 w-10 h-10 flex items-center justify-center bg-primary/10 text-primary border border-primary/20">
                        <span class="material-symbols-outlined text-lg">sync</span>
                    </div>
                    <div>
                        <h3 class="font-bold text-archive-heading text-sm uppercase mb-1">Pipeline Integration</h3>
                        <p class="text-xs text-archive-secondary/70">Runs automatically after OCR processing, seamlessly
                            integrating with the extraction workbench.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- ENTITY LINKER -->
        <section class="mb-12">
            <h2
                class="text-xl font-bold text-archive-heading uppercase tracking-wider border-l-4 border-primary pl-4 mb-6">
                Entity Linker Engine
            </h2>
            <div class="prose prose-invert max-w-none text-archive-secondary/90 text-sm leading-relaxed mb-6">
                <p>
                    The Entity Linker is the runtime engine that cross-references archival text with the
                    People and Places databases. It builds high-speed pattern matchers at startup and uses
                    RapidFuzz for fuzzy matching when exact patterns don't match.
                </p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="border border-archive-secondary/20 bg-archive-dark/30 p-4">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="material-symbols-outlined text-primary">person</span>
                        <h3 class="font-bold text-archive-heading text-sm uppercase">People Database</h3>
                    </div>
                    <p class="text-xs text-archive-secondary/70 mb-2">Matches against display names, given names, family
                        names, and known aliases.</p>
                    <span class="text-[9px] bg-emerald-500/20 text-emerald-400 px-2 py-1">22 People</span>
                </div>
                <div class="border border-archive-secondary/20 bg-archive-dark/30 p-4">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="material-symbols-outlined text-primary">location_on</span>
                        <h3 class="font-bold text-archive-heading text-sm uppercase">Places Database</h3>
                    </div>
                    <p class="text-xs text-archive-secondary/70 mb-2">Matches against place names, addresses, and
                        location descriptions.</p>
                    <span class="text-[9px] bg-emerald-500/20 text-emerald-400 px-2 py-1">16 Places</span>
                </div>
            </div>
            <div class="mt-4 bg-archive-dark/50 border border-archive-secondary/20 p-4">
                <p class="text-xs text-archive-secondary/70 mb-2"><strong class="text-archive-heading">Data
                        Sources:</strong></p>
                <code class="text-[10px] text-primary">web/html/assets/data/people.json</code><br>
                <code class="text-[10px] text-primary">web/html/assets/data/places.json</code>
            </div>
        </section>

        <!-- API USAGE -->
        <section class="mb-12">
            <h2
                class="text-xl font-bold text-archive-heading uppercase tracking-wider border-l-4 border-primary pl-4 mb-6">
                API Usage
            </h2>
            <div class="bg-archive-dark/50 border border-archive-secondary/20 p-5">
                <pre class="text-[11px] font-mono text-archive-secondary/90 overflow-x-auto"><code>from entity_matcher import EntityMatcher
from entity_linker import EntityLinker
from pathlib import Path

# Entity Matcher — Vault-based matching
matcher = EntityMatcher(vault_url="https://your-vault.supabase.co")
matches = matcher.match("Lee Harvey Oswald was seen...")
for match in matches:
    print(f"{match.text} -> {match.entity_type}: {match.entity_id}")

# Entity Linker — Local JSON-based matching (used in OCR pipeline)
DATA_DIR = Path("assets/data")
linker = EntityLinker(DATA_DIR)
entities = linker.link_entities("Ralph Yates drove to Dallas...")
for ent in entities:
    print(f"{ent['matched_text']} -> {ent['type']}: {ent['id']}")</code></pre>
            </div>
        </section>

        <!-- STATUS -->
        <section class="border border-emerald-500/30 bg-emerald-500/5 p-6">
            <div class="flex items-center gap-3 mb-3">
                <span class="material-symbols-outlined text-emerald-400">check_circle</span>
                <span class="font-bold text-emerald-400 uppercase tracking-wider text-sm">Status: Live</span>
            </div>
            <p class="text-xs text-archive-secondary/80">
                The Entity Matcher is fully operational and integrated with the OCR processing pipeline.
                Supports all entity types in the research vault with fuzzy matching and confidence scoring.
            </p>
        </section>

    </main>

    <hr class="border-archive-secondary/20" />

    <!-- MODULAR FOOTER -->
    <div data-component="footer" class="component-loaded"></div>

<!-- MODULAR BOTTOM NAV -->
    <nav data-component="bottom-nav" data-active="Tools"
        class="fixed bottom-0 z-50 w-full border-t border-archive-secondary/20 bg-archive-bg px-6 py-4"></nav>

    <div class="h-24"></div>

</body>

</html>